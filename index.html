<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rankings</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      h1,
      h2 {
        text-align: center;
      }

      .hidden {
        display: none;
      }

      .studentEdit {
        margin: 10px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }

      .editButton {
        margin-left: 10px;
        padding: 5px 10px;
        border: none;
        background-color: #007bff;
        color: #fff;
        cursor: pointer;
        border-radius: 5px;
      }

      .editButton:hover {
        background-color: #0056b3;
      }

      #rankings,
      #editStudentForm,
      #addStudentForm {
        max-width: 600px;
        margin: auto;
        padding: 10px;
      }

      form {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      input[type="number"],
      input[type="text"] {
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
        width: 100%;
      }

      button {
        padding: 10px;
        border: none;
        color: #fff;
        cursor: pointer;
        border-radius: 5px;
        background-color: #007bff;
      }

      button:hover {
        background-color: #0056b3;
      }

      .editButton,
      button {
        width: auto;
        align-self: center;
      }

      @media (max-width: 600px) {
        .studentEdit {
          font-size: 14px;
        }

        form {
          padding: 5px;
        }
      }
    </style>
  </head>
  <body>
    <h1>Student Rankings</h1>
    <div id="rankings"></div>

    <div id="editStudentForm" class="hidden">
      <h2>Edit Student Details</h2>
      <label for="editStudentId">Student ID:</label>
      <input type="number" id="editStudentId" disabled /><br />

      <label for="editLevel">Level:</label>
      <input type="number" id="editLevel" required /><br />

      <label for="editName">Name:</label>
      <input type="text" id="editName" required /><br />

      <button id="saveEditButton">Save</button>
      <button id="cancelEditButton" type="button">Cancel</button>
    </div>

    <h2>Add New Student</h2>
    <form id="addStudentForm">
      <label for="studentId">Student ID:</label>
      <input type="number" id="studentId" required /><br />

      <label for="level">Level:</label>
      <input type="number" id="level" required /><br />

      <label for="name">Name:</label>
      <input type="text" id="name" required /><br />
      <button type="submit">추가</button>
    </form>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const rankingsDiv = document.getElementById("rankings");
        const editStudentForm = document.getElementById("editStudentForm");
        const editStudentIdInput = document.getElementById("editStudentId");
        const editLevelInput = document.getElementById("editLevel");
        const editNameInput = document.getElementById("editName");
        const saveEditButton = document.getElementById("saveEditButton");
        const cancelEditButton = document.getElementById("cancelEditButton");
        let currentEditId = null;

        function fetchAndDisplayRankings() {
          fetch("https://api.ajoufesta.com/v1/game/manager")
            .then((response) => response.json())
            .then((data) => {
              rankingsDiv.innerHTML = "";

              data.sort((a, b) => b.level - a.level);

              data.forEach((student) => {
                const studentDiv = document.createElement("div");
                studentDiv.classList.add("studentEdit");
                studentDiv.innerHTML = `ID: ${student.studentId}, Level: ${student.level}, Name: ${student.name}`;

                const editButton = document.createElement("button");
                editButton.textContent = "Edit";
                editButton.classList.add("editButton");
                editButton.addEventListener("click", () => {
                  currentEditId = student.studentId;
                  editStudentIdInput.value = student.studentId;
                  editLevelInput.value = student.level;
                  editNameInput.value = student.name;
                  rankingsDiv.classList.add("hidden");
                  editStudentForm.classList.remove("hidden");
                });

                studentDiv.appendChild(editButton);
                rankingsDiv.appendChild(studentDiv);
              });
            })
            .catch((error) => console.error("Error fetching rankings:", error));
        }

        saveEditButton.addEventListener("click", () => {
          const studentId = parseInt(editStudentIdInput.value);
          const level = parseInt(editLevelInput.value);
          const name = editNameInput.value;

          const formData = {
            studentId: studentId,
            level: level,
            name: name,
            password: "donghwa0302!A",
          };

          fetch("https://api.ajoufesta.com/v1/game/manager/edit/" + studentId, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          })
            .then((response) => {
              if (response.ok) {
                console.log("Student edited successfully");
                fetchAndDisplayRankings();
                editStudentForm.classList.add("hidden");
                rankingsDiv.classList.remove("hidden");
                return response.text();
              }
              throw new Error("Failed to edit student");
            })
            .catch((error) => console.error("Error editing student:", error));
        });

        cancelEditButton.addEventListener("click", () => {
          editStudentForm.classList.add("hidden");
          rankingsDiv.classList.remove("hidden");
        });

        fetchAndDisplayRankings();

        const addStudentForm = document.getElementById("addStudentForm");
        addStudentForm.addEventListener("submit", function (event) {
          event.preventDefault();

          const studentId = document.getElementById("studentId").value;
          const level = document.getElementById("level").value;
          const name = document.getElementById("name").value;

          const formData = {
            studentId: parseInt(studentId),
            level: parseInt(level),
            name: name,
            password: "donghwa0302!A",
          };

          fetch("https://api.ajoufesta.com/v1/game/manager/add", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          })
            .then((response) => {
              if (response.ok) {
                console.log("Student added successfully");
                fetchAndDisplayRankings();
                return response.text();
              }
              throw new Error("Failed to add student");
            })
            .catch((error) => console.error("Error adding student:", error));
        });
      });
    </script>
  </body>
</html>
